<Window x:Class="UltAssist.MainWindowV2"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="UltAssist V2 - å¤šæŒ‰é”®éŸ³ä¹æ˜ å°„ç³»ç»Ÿ" Height="700" Width="900"
        MinHeight="600" MinWidth="800">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- æ ‡é¢˜å’ŒçŠ¶æ€æ  -->
        <Border Grid.Row="0" Background="#2E3440" Padding="10,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ðŸŽµ UltAssist V2" FontSize="16" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                    <Rectangle Width="1" Fill="#4C566A" Margin="15,0"/>
                    <TextBlock Text="çŠ¶æ€:" Foreground="#D8DEE9" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock x:Name="StatusText" Text="å°±ç»ª" Foreground="#A3BE8C" VerticalAlignment="Center" FontWeight="SemiBold"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="æ¸¸æˆçª—å£:" Foreground="#D8DEE9" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock x:Name="GameWindowText" Text="æœªæ£€æµ‹åˆ°" Foreground="#EBCB8B" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,15,0"/>
                    <TextBlock Text="å…¨å±€ç›‘å¬:" Foreground="#D8DEE9" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock x:Name="GlobalEnabledText" Text="å¼€å¯" Foreground="#A3BE8C" VerticalAlignment="Center" FontWeight="SemiBold"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="15">
                
                <!-- ========== 1. å…¨å±€é…ç½®åŒºåŸŸ ========== -->
                <GroupBox Header="ðŸŒ å…¨å±€é…ç½®" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,15">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- è®¾å¤‡é€‰æ‹© -->
                        <StackPanel Grid.Row="0" Margin="0,0,0,15">
                            <TextBlock Text="ðŸŽ§ éŸ³é¢‘è®¾å¤‡é€‰æ‹©" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="15"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="æ’­æ”¾è®¾å¤‡ (æ‚¨å¬åˆ°çš„éŸ³é¢‘):" Margin="0,0,0,3"/>
                                    <ComboBox x:Name="HeadphoneCombo" DisplayMemberPath="Name"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="è™šæ‹Ÿè®¾å¤‡ (é˜Ÿå‹å¬åˆ°çš„éŸ³é¢‘):" Margin="0,0,0,3"/>
                                    <ComboBox x:Name="VirtualMicCombo" DisplayMemberPath="Name"/>
                                </StackPanel>
                            </Grid>
                            

                        </StackPanel>
                        
                        <!-- ç›‘å¬èŒƒå›´é…ç½® -->
                        <StackPanel Grid.Row="1" Margin="0,0,0,15">
                            <TextBlock Text="ðŸŽ¯ ç›‘å¬èŒƒå›´" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="15"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <RadioButton x:Name="GameWindowOnlyRadio" Content="ä»…æ¸¸æˆçª—å£" 
                                               ToolTip="åªåœ¨æ¸¸æˆçª—å£æ¿€æ´»æ—¶ç›‘å¬æŒ‰é”®"
                                               Checked="ListeningModeRadio_Changed"/>
                                    <RadioButton x:Name="GlobalListenRadio" Content="å…¨å±€ç›‘å¬" IsChecked="True" Margin="0,5,0,0"
                                               ToolTip="åœ¨ä»»ä½•çª—å£éƒ½ç›‘å¬æŒ‰é”®"
                                               Checked="ListeningModeRadio_Changed"/>
                                </StackPanel>
                                
                                <StackPanel x:Name="GameProcessPanel" Grid.Column="2" Visibility="Collapsed">
                                    <TextBlock Text="ç›‘å¬çš„æ¸¸æˆè¿›ç¨‹:" Margin="0,0,0,3"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ComboBox x:Name="GameProcessCombo" Grid.Column="0" 
                                                IsEditable="True" 
                                                Text="NarakaBladepoint.exe"
                                                ToolTip="é€‰æ‹©æˆ–è¾“å…¥æ¸¸æˆè¿›ç¨‹åï¼Œæ”¯æŒå¤šä¸ªè¿›ç¨‹ç”¨åˆ†å·åˆ†éš”"/>
                                        <Button x:Name="RefreshProcessBtn" Grid.Column="1" 
                                               Content="ðŸ”„" Width="32" Height="24" Margin="5,0,0,0"
                                               ToolTip="åˆ·æ–°è¿›ç¨‹åˆ—è¡¨" 
                                               Click="RefreshProcessBtn_Click"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                        
                        <!-- é¡¶éƒ¨æŒ‡ç¤ºæ é…ç½® -->
                        <StackPanel Grid.Row="2" Margin="0,0,0,15">
                            <TextBlock Text="ðŸ“Š é¡¶éƒ¨æŒ‡ç¤ºæ " FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <StackPanel>
                                <TextBlock Text="æ˜¾ç¤ºæ ·å¼:" Margin="0,0,0,3"/>
                                <ComboBox x:Name="OverlayStyleCombo">
                                    <ComboBoxItem Content="æ— " Tag="None"/>
                                    <ComboBoxItem Content="ç®€å•" Tag="StatusOnly"/>
                                    <ComboBoxItem Content="å®Œæ•´" Tag="DebugPanel"/>
                                </ComboBox>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- å¼€å‘è€…é€‰é¡¹ (éšè—æŒ‰é’®ï¼ŒåŒå‡»ä¸‰æ¬¡å¯ç”¨Debug) -->
                        <StackPanel Grid.Row="3" Margin="0,0,0,15">
                            <Border x:Name="DevAccessBorder" 
                                   HorizontalAlignment="Right" 
                                   VerticalAlignment="Top"
                                   Padding="2,1" 
                                   Background="Transparent"
                                   Cursor="Hand" 
                                   MouseLeftButtonDown="DevAccessText_MouseLeftButtonDown"
                                   ToolTip="">
                                <TextBlock x:Name="DevAccessText" Text="." FontSize="6" Foreground="#F0F0F0"/>
                            </Border>
                        </StackPanel>
                        
                        <!-- ä¿å­˜æŒ‰é’® -->
                        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button x:Name="SaveGlobalBtn" Content="ðŸ’¾ ä¿å­˜å…¨å±€è®¾ç½®" Padding="15,8" 
                                   Background="#5E81AC" Foreground="White" BorderThickness="0"
                                   Click="SaveGlobalBtn_Click"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <!-- ========== 2. é…ç½®åˆ‡æ¢&ä¿®æ”¹åŒºåŸŸ ========== -->
                <GroupBox Header="âš™ï¸ æ–¹æ¡ˆé…ç½®ç®¡ç†" FontSize="14" FontWeight="SemiBold" Margin="0,0,0,15">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- æ–¹æ¡ˆé€‰æ‹©å’Œæ“ä½œ -->
                        <Grid Grid.Row="0" Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Text="å½“å‰æ–¹æ¡ˆ:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <ComboBox x:Name="HeroCombo" Width="150" SelectionChanged="HeroCombo_SelectionChanged"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button x:Name="AddProfileBtn" Content="âž• æ–°å¢žæ–¹æ¡ˆ" Margin="0,0,5,0" Padding="8,5"
                                       Click="AddProfileBtn_Click"/>
                                <Button x:Name="DeleteProfileBtn" Content="ðŸ—‘ï¸ åˆ é™¤æ–¹æ¡ˆ" Margin="0,0,5,0" Padding="8,5"
                                       Click="DeleteProfileBtn_Click"/>
                                <Separator Margin="10,0" />
                                <Button x:Name="CopyConfigBtn" Content="ðŸ“‹ å¤åˆ¶é…ç½®" Margin="0,0,5,0" Padding="8,5"
                                       Click="CopyConfigBtn_Click"/>
                                <Button x:Name="ImportConfigBtn" Content="ðŸ“ å¯¼å…¥" Margin="0,0,5,0" Padding="8,5"
                                       Click="ImportConfigBtn_Click"/>
                                <Button x:Name="ExportConfigBtn" Content="ðŸ’¾ å¯¼å‡º" Padding="8,5"
                                       Click="ExportConfigBtn_Click"/>
                            </StackPanel>
                        </Grid>
                        
                        <!-- å½“å‰æ’­æ”¾çŠ¶æ€ -->
                        <Border Grid.Row="1" Background="#ECEFF4" CornerRadius="5" Padding="10,8" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="ðŸŽµ å½“å‰æ’­æ”¾:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                <TextBlock x:Name="CurrentlyPlayingText" Text="æ— " FontFamily="Consolas" 
                                         Foreground="#2E3440" TextWrapping="Wrap"/>
                                <Button x:Name="StopAllBtn" Content="â¹ï¸ åœæ­¢æ‰€æœ‰" HorizontalAlignment="Right" 
                                       Padding="8,3" Margin="0,5,0,0" Click="StopAllBtn_Click"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- æŒ‰é”®æ˜ å°„åˆ—è¡¨ -->
                        <Grid Grid.Row="2" Margin="0,0,0,15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                                <TextBlock Text="ðŸŽ¹ æŒ‰é”®æ˜ å°„" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                <Button x:Name="AddMappingBtn" Content="âž• æ·»åŠ æ–°æ˜ å°„" Margin="15,0,0,0" 
                                       Padding="10,5" Background="#A3BE8C" Foreground="White" BorderThickness="0"
                                       Click="AddMappingBtn_Click"/>
                            </StackPanel>
                            
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="250">
                                <ItemsControl x:Name="KeyMappingsList">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="White" BorderBrush="#D8DEE9" BorderThickness="1" 
                                                   CornerRadius="5" Margin="0,0,0,8" Padding="12">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                                        <TextBlock Text="{Binding KeyDisplayText}" FontFamily="Consolas" 
                                                                 FontSize="14" FontWeight="SemiBold" Background="#5E81AC" 
                                                                 Foreground="White" Padding="8,4" HorizontalAlignment="Center"/>
                                                        <TextBlock Text="{Binding AudioFileName}" FontSize="11" 
                                                                 HorizontalAlignment="Center" Margin="0,3,0,0" 
                                                                 Foreground="#5E81AC"/>
                                                    </StackPanel>
                                                    
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" 
                                                                 Margin="0,0,0,3"/>
                                                        <TextBlock Text="{Binding SettingsText}" FontSize="11" 
                                                                 Foreground="#5E81AC"/>
                                                    </StackPanel>
                                                    
                                                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                                                        <Button Content="â–¶ï¸ æµ‹è¯•" Padding="6,3" Margin="0,0,3,0"
                                                               Tag="{Binding}" Click="TestMappingBtn_Click"/>
                                                        <Button Content="âœï¸ ç¼–è¾‘" Padding="6,3" Margin="0,0,3,0"
                                                               Tag="{Binding}" Click="EditMappingBtn_Click"/>
                                                        <Button Content="ðŸ—‘ï¸ åˆ é™¤" Padding="6,3" Background="#BF616A" 
                                                               Foreground="White" BorderThickness="0"
                                                               Tag="{Binding}" Click="DeleteMappingBtn_Click"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                </GroupBox>

                <!-- ========== 3. Debugä¿¡æ¯é¢æ¿ (ä»…Debugæ¨¡å¼æ˜¾ç¤º) ========== -->
                <GroupBox x:Name="DebugPanel" Header="ðŸ”§ Debugä¿¡æ¯" FontSize="14" FontWeight="SemiBold" 
                         Visibility="Collapsed">
                    <StackPanel Margin="10">
                        <!-- Debugæ¨¡å¼å¼€å…³ -->
                        <CheckBox x:Name="DebugModeCheck" Content="å¯ç”¨Debugæ¨¡å¼" 
                                 Checked="DebugModeCheck_Changed" Unchecked="DebugModeCheck_Changed"
                                 Margin="0,0,0,15"/>
                        
                        <!-- æœ€åŽæŒ‰é”®ä¿¡æ¯ -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="æœ€åŽæŒ‰é”®:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock x:Name="LastKeyText" Text="æ— " VerticalAlignment="Center" 
                                     FontFamily="Consolas" Background="#ECEFF4" Padding="5,2"/>
                            <TextBlock x:Name="LastKeyTimeText" Text="" VerticalAlignment="Center" 
                                     Foreground="#5E81AC" Margin="8,0,0,0" FontSize="11"/>
                        </StackPanel>
                        
                        <!-- ä¸´æ—¶éº¦å…‹é£Žåˆ‡æ¢ -->
                        <CheckBox x:Name="TempDefaultMicCheck" Content="è¿è¡Œæ—¶å°†é»˜è®¤éº¦å…‹é£Žåˆ‡åˆ°è™šæ‹Ÿéº¦" 
                                 Margin="0,0,0,10" ToolTip="å‹¾é€‰åŽè‡ªåŠ¨å°†ç³»ç»Ÿé»˜è®¤å½•éŸ³è®¾å¤‡åˆ‡æ¢åˆ°è™šæ‹Ÿéº¦å…‹é£Ž"/>
                        
                        <!-- DebugåŠŸèƒ½æŒ‰é’® -->
                        <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                            <Button x:Name="SelectRoiBtn" Content="ðŸŽ¯ é€‰æ‹©ROIåŒºåŸŸ" Margin="0,0,10,0" 
                                   Padding="8,5" Click="SelectRoiBtn_Click"/>
                            <TextBlock Text="DebugåŠŸèƒ½ï¼šç”¨äºŽå¼€å‘å’Œæ•…éšœæŽ’é™¤" 
                                     VerticalAlignment="Center" Foreground="#5E81AC" FontStyle="Italic"/>
                        </StackPanel>
                        
                        <!-- æ—¥å¿—åŠŸèƒ½æŒ‰é’® -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                            <Button x:Name="OpenLogBtn" Content="ðŸ“‹ æŸ¥çœ‹æ—¥å¿—" Padding="8,5" Margin="0,0,8,0"
                                   Background="#88C0D0" Foreground="White" BorderThickness="0"
                                   ToolTip="æ‰“å¼€å½“å‰ä¼šè¯æ—¥å¿—æ–‡ä»¶"
                                   Click="OpenLogBtn_Click"/>
                            <Button x:Name="OpenLogDirBtn" Content="ðŸ“ æ—¥å¿—ç›®å½•" Padding="8,5" Margin="0,0,8,0"
                                   Background="#A3BE8C" Foreground="White" BorderThickness="0"
                                   ToolTip="æ‰“å¼€æ—¥å¿—æ–‡ä»¶å¤¹"
                                   Click="OpenLogDirBtn_Click"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
                
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
